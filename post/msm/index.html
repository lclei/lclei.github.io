<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>boost meta state machine - lclei blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="lclei" /><meta name="description" content="MSM Meta State Machineï¼Œæ˜¯booståº“çš„å…ƒçŠ¶æ€æœºï¼Œä½¿ç”¨äº†å¤§é‡çš„æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œè®©ä½¿ç”¨è€…è½»æ¾åˆ›å»ºå‡ºå¥½ç”¨ï¼Œå¯é˜…è¯»ï¼Œæ•ˆç‡é«˜çš„çŠ¶æ€æœºã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨çŠ¶æ€è½¬" /><meta name="keywords" content="lclei, blog, code" />






<meta name="generator" content="Hugo 0.92.2 with theme even" />


<link rel="canonical" href="http://localhost:1313/post/msm/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.07cd396beabaa8e7888dfdeb1981afff139a5394f3cb79465e70008be0d583a5.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="boost meta state machine" />
<meta property="og:description" content="MSM Meta State Machineï¼Œæ˜¯booståº“çš„å…ƒçŠ¶æ€æœºï¼Œä½¿ç”¨äº†å¤§é‡çš„æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œè®©ä½¿ç”¨è€…è½»æ¾åˆ›å»ºå‡ºå¥½ç”¨ï¼Œå¯é˜…è¯»ï¼Œæ•ˆç‡é«˜çš„çŠ¶æ€æœºã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨çŠ¶æ€è½¬" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/msm/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-10T00:00:00+00:00" />

<meta itemprop="name" content="boost meta state machine">
<meta itemprop="description" content="MSM Meta State Machineï¼Œæ˜¯booståº“çš„å…ƒçŠ¶æ€æœºï¼Œä½¿ç”¨äº†å¤§é‡çš„æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œè®©ä½¿ç”¨è€…è½»æ¾åˆ›å»ºå‡ºå¥½ç”¨ï¼Œå¯é˜…è¯»ï¼Œæ•ˆç‡é«˜çš„çŠ¶æ€æœºã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨çŠ¶æ€è½¬"><meta itemprop="datePublished" content="2022-07-10T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-07-10T00:00:00+00:00" />
<meta itemprop="wordCount" content="3535">
<meta itemprop="keywords" content="cpp,boost," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="boost meta state machine"/>
<meta name="twitter:description" content="MSM Meta State Machineï¼Œæ˜¯booståº“çš„å…ƒçŠ¶æ€æœºï¼Œä½¿ç”¨äº†å¤§é‡çš„æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œè®©ä½¿ç”¨è€…è½»æ¾åˆ›å»ºå‡ºå¥½ç”¨ï¼Œå¯é˜…è¯»ï¼Œæ•ˆç‡é«˜çš„çŠ¶æ€æœºã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨çŠ¶æ€è½¬"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">lclei</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">lclei</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">boost meta state machine</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-07-10 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ä»ä¸€ä¸ªç®€å•çš„çŠ¶æ€æœºå¼€å§‹">ä»ä¸€ä¸ªç®€å•çš„çŠ¶æ€æœºå¼€å§‹</a></li>
        <li><a href="#state">State</a></li>
        <li><a href="#action">Action</a></li>
        <li><a href="#guard">Guard</a></li>
        <li><a href="#transition_table">transition_table</a></li>
        <li><a href="#if-else">if-else</a></li>
        <li><a href="#çŠ¶æ€è‡ªè½¬ç§»">çŠ¶æ€è‡ªè½¬ç§»</a></li>
        <li><a href="#exception">exception</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>MSM Meta State Machineï¼Œæ˜¯booståº“çš„å…ƒçŠ¶æ€æœºï¼Œä½¿ç”¨äº†å¤§é‡çš„æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œè®©ä½¿ç”¨è€…è½»æ¾åˆ›å»ºå‡ºå¥½ç”¨ï¼Œå¯é˜…è¯»ï¼Œæ•ˆç‡é«˜çš„çŠ¶æ€æœºã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨çŠ¶æ€è½¬ç§»è¡¨ transition_table æ¥å®šä¹‰çŠ¶æ€æœºè½¬ç§»çš„è¿‡ç¨‹ï¼Œéå¸¸ç›´è§‚ï¼Œæ˜“äºé˜…è¯»ï¼Œä¿®æ”¹ï¼Œæ’é”™å’Œä¿®æ”¹ã€‚çŠ¶æ€è½¬ç§»è¡¨çš„è¦ç´ æ˜¯æºçŠ¶æ€ Sourcce Stateï¼Œç›®æ ‡çŠ¶æ€ Target Stateï¼Œè§¦å‘äº‹ä»¶Eventï¼Œå®ˆå«æ¡ä»¶Guardå’Œæ‰§è¡ŒåŠ¨ä½œActionã€‚</p>
<p>æœ¬æ–‡ä»£ç ç¤ºä¾‹åœ¨<a href="https://gitee.com/lclei/boost_msm_guide">boost_msm_guide</a></p>
<h2 id="ä»ä¸€ä¸ªç®€å•çš„çŠ¶æ€æœºå¼€å§‹">ä»ä¸€ä¸ªç®€å•çš„çŠ¶æ€æœºå¼€å§‹</h2>
<p>ä½¿ç”¨boost msmå®šä¹‰ä¸€ä¸ªç®€å•çš„çŠ¶æ€æœºåˆ†ä¸º6æ­¥ï¼š</p>
<ol>
<li>å®šä¹‰äº‹ä»¶Event</li>
<li>å®šä¹‰çŠ¶æ€æœºfront-end <code>boost::msm::front::state_machine_def</code></li>
<li>å®šä¹‰çŠ¶æ€</li>
<li>è®¾ç½®åˆå§‹çŠ¶æ€</li>
<li>å®šä¹‰çŠ¶æ€è½¬ç§»è¡¨</li>
<li>ç”ŸæˆçŠ¶æ€æœºback-end</li>
</ol>
<p>çŠ¶æ€æœºä½¿ç”¨æ—¶</p>
<ol>
<li>å®šä¹‰çŠ¶æ€æœºå®ä¾‹fsm</li>
<li>å¼€å§‹çŠ¶æ€æœºfsm.start()</li>
<li>å¤„ç†äº‹ä»¶fsm.process_event()</li>
</ol>
<p>é¦–å…ˆä»ä¸€ä¸ªåªæœ‰çŠ¶æ€è½¬ç§»çš„ç®€å•çŠ¶æ€æœºå¼€å§‹</p>
<p><img src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL8ioKZDJLKeo4dCpEC2YfQaAWI3I4C5AuNClCoIpCISUB0mLD8rBmKeKv9Qb9kP1vU2wj2rWqgxbgNcbHXoEQJcfG3j0000" alt=""></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;boost/msm/back/state_machine.hpp&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;boost/msm/front/state_machine_def.hpp&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;boost/msm/front/functor_row.hpp&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">namespace</span> <span class="p">{</span>
    <span class="c1">// ---Events
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">Event1</span> <span class="p">{};</span>

    <span class="c1">// ---State Machine front-end
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">Sm</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">state_machine_def</span><span class="o">&lt;</span><span class="n">Sm</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="c1">// States
</span><span class="c1"></span>        <span class="k">struct</span> <span class="nc">State1</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">state</span><span class="o">&lt;&gt;</span> <span class="p">{</span>
            <span class="c1">// Entry Action
</span><span class="c1"></span>            <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="o">&gt;</span>
            <span class="kt">void</span> <span class="n">on_entry</span><span class="p">(</span><span class="n">Event</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">Fsm</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Entering State1</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// Exit Action
</span><span class="c1"></span>            <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="o">&gt;</span>
            <span class="kt">void</span> <span class="n">on_exit</span><span class="p">(</span><span class="n">Event</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">Fsm</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Leaving State1</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">struct</span> <span class="nc">End</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">terminate_state</span><span class="o">&lt;&gt;</span> <span class="p">{};</span>

        <span class="c1">// Set initial state
</span><span class="c1"></span>        <span class="k">using</span> <span class="n">initial_state</span> <span class="o">=</span> <span class="n">State1</span><span class="p">;</span>

        <span class="c1">// Transition Table
</span><span class="c1"></span>        <span class="k">struct</span> <span class="nc">transition_table</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span>
            <span class="c1">//    Start | Event | Next | Action | Guard
</span><span class="c1"></span>            <span class="n">_row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event1</span><span class="p">,</span> <span class="n">End</span>                  <span class="o">&gt;</span>
        <span class="o">&gt;</span> <span class="p">{};</span>
    <span class="p">};</span>

    <span class="c1">// Pick a back-end
</span><span class="c1"></span>    <span class="k">using</span> <span class="n">Fsm</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="nl">msm</span><span class="p">:</span><span class="err">ğŸ”™</span><span class="o">:</span><span class="n">state_machine</span><span class="o">&lt;</span><span class="n">Sm</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Fsm</span> <span class="n">fsm</span><span class="p">;</span>
        <span class="n">fsm</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&gt; Send Event1</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="n">fsm</span><span class="p">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">Event1</span><span class="p">{});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘è¿è¡Œæ­¤çŠ¶æ€ï¼Œæ‰“å°æ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Entering State1
&gt; Send Event1
Leaving State1
</code></pre></td></tr></table>
</div>
</div><h2 id="state">State</h2>
<p>çŠ¶æ€æœºçš„ç¬¬ä¸€è¦ç´ å½“ç„¶æ˜¯çŠ¶æ€ï¼Œä¸€ä¸ªçŠ¶æ€æœºçš„ä¸€ç”Ÿå°±æ˜¯åœ¨å„ä¸ªçŠ¶æ€é—´æ¥æ¥å»å»ã€‚çŠ¶æ€é—´çš„è¿ç§»ç”±Eventäº‹ä»¶è§¦å‘ï¼Œè¿ç§»ä¸­é—´å¯ä»¥æ‰§è¡ŒActionï¼Œæ˜¯å¦èƒ½è¿ç§»å–å†³äºGuardã€‚æ¯ä¸ªçŠ¶æ€å¸¦æœ‰on_entryå’Œon_exitä¸¤ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œåœ¨è¿›å…¥å’Œç¦»å¼€æ—¶è§¦å‘ã€‚</p>
<p>ä¸ºäº†åç»­æ›´å¥½çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªbase classæ‰§è¡Œä¸€äº›åŸºç¡€çš„æ‰“å°ã€‚<br>
é¦–å…ˆï¼Œè·å–typeçš„åç§°ã€‚æˆ‘ä»¬çŸ¥é“æ ‡å‡†åº“ä¸­çš„<code>typeid(var).name()</code>æ–¹æ³•å¯ä»¥è·å–åˆ°å˜é‡çš„ç±»å‹åç§°ï¼Œä½†æ˜¯æ˜¯å†…éƒ¨çš„ç¬¦å·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡boost::core::demangleæ–¹æ³•æ¥è·å–æ›´æ˜“è¯»çš„åç§°ï¼ŒåŒæ—¶æŠŠå‘½åç©ºé—´çš„å‰ç¼€å»æ‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">get_typename</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">demangle</span><span class="p">(</span><span class="k">typeid</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">name</span><span class="p">());</span>
    <span class="k">auto</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">name</span><span class="p">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#34;::&#34;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>BaseStateè´Ÿè´£åœ¨on_entryå’Œon_exitæ—¶æ‰“å°æ—¥å¿—ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ç”±çŠ¶æ€æœºåœ¨è¿›å…¥å’Œç¦»å¼€çŠ¶æ€æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚ä¸ºäº†ç»§æ‰¿çš„å­ç±»å¯ä»¥å®šåˆ¶ä¸€äº›åŠ¨ä½œï¼Œå®šä¹‰äº†è™šå‡½æ•°prepareå’Œcleanï¼Œå‚æ•°ä¸ºçŠ¶æ€æœºå†…çš„ctxã€‚å®é™…ä¸Šï¼Œè¿™é‡Œå’Œon_entryä¸€æ ·ä¼ å…¥template Eventå’ŒFsmå‚æ•°æ›´å¥½ï¼Œä½†æ˜¯ç”±äºc++è¯­è¨€çš„é™åˆ¶ï¼Œæ¨¡æ¿å‡½æ•°ä¸èƒ½ä¸ºè™šå‡½æ•°ï¼Œæ‰€ä»¥é€€è€Œæ±‚å…¶æ¬¡ï¼Œä¼ å…¥ä¸€ä¸ªæ–°çš„Contextå˜é‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">BaseState</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">state</span><span class="o">&lt;&gt;</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">BaseState</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">on_entry</span><span class="p">(</span><span class="n">Event</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">,</span> <span class="n">Fsm</span> <span class="o">&amp;</span><span class="n">fsm</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;[state]...Entering &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34; by &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="n">prepare</span><span class="p">(</span><span class="n">fsm</span><span class="p">.</span><span class="n">ctx</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">on_exit</span><span class="p">(</span><span class="n">Event</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">,</span> <span class="n">Fsm</span> <span class="o">&amp;</span><span class="n">fsm</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;[state]...Leaving &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34; by &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="n">clean</span><span class="p">(</span><span class="n">fsm</span><span class="p">.</span><span class="n">ctx</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">clean</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„çŠ¶æ€æœºå¾—ä»¥ç²¾ç®€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp">    <span class="k">struct</span> <span class="nc">Sm</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">state_machine_def</span><span class="o">&lt;</span><span class="n">Sm</span><span class="o">&gt;</span>
    <span class="p">{</span>
    <span class="c1">// ---States
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">State1</span> <span class="o">:</span> <span class="n">BaseState</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">End</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">terminate_state</span><span class="o">&lt;&gt;</span> <span class="p">{};</span>

    <span class="c1">// ---Set initial state
</span><span class="c1"></span>    <span class="k">using</span> <span class="n">initial_state</span> <span class="o">=</span> <span class="n">State1</span><span class="p">;</span>

    <span class="c1">// ---Transition Table
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">transition_table</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span>
        <span class="c1">//    Start | Event | Next | Action | Guard
</span><span class="c1"></span>        <span class="n">_row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event1</span><span class="p">,</span> <span class="n">End</span>                  <span class="o">&gt;</span>
    <span class="o">&gt;</span> <span class="p">{};</span>

    <span class="n">Context</span> <span class="n">ctx</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// ---Pick a back-end
</span><span class="c1"></span><span class="k">using</span> <span class="n">Fsm</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="nl">msm</span><span class="p">:</span><span class="err">ğŸ”™</span><span class="o">:</span><span class="n">state_machine</span><span class="o">&lt;</span><span class="n">Sm</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>æ‰“å°æ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">[state]...Entering State1 by InitEvent
&gt; Send Event1
[state]...Leaving State1 by Event1
</code></pre></td></tr></table>
</div>
</div><p>å€¼å¾—æ³¨æ„çš„æ˜¯InitEventï¼Œå®ƒæ˜¯ä»å“ªæ¥çš„ï¼Ÿæˆ‘ä»¬çš„transition_tableå¹¶æ²¡æœ‰å®šä¹‰è¿™ä¸ªäº‹ä»¶ï¼å®é™…ä¸Šï¼Œè¿™æ˜¯Fsmè¿›å…¥initial_stateçš„é»˜è®¤è§¦å‘äº‹ä»¶ã€‚</p>
<h2 id="action">Action</h2>
<p>Actionå‘ç”Ÿåœ¨ç¦»å¼€çŠ¶æ€åï¼Œè¿›å…¥ä¸‹ä¸€çŠ¶æ€å‰ã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªFunctor classæ¥è¡¨ç¤ºã€‚å’ŒStateä¸€æ ·ï¼Œè¿™é‡Œå®šä¹‰ä¸€ä¸ªBaseActionçš„ç±»ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">BaseAction</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">BaseAction</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SourceState</span><span class="p">,</span> <span class="k">class</span> <span class="nc">TargetState</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="n">Event</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">,</span> <span class="n">Fsm</span> <span class="o">&amp;</span><span class="n">fsm</span><span class="p">,</span> <span class="n">SourceState</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">from</span><span class="p">,</span> <span class="n">TargetState</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">to</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&gt;&gt;</span> <span class="s">&#34;[action] Do &#34;</span> <span class="o">&gt;&gt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="s">&#34; from &#34;</span> <span class="o">&gt;&gt;</span>
                <span class="o">&gt;&gt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">from</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="s">&#34; to &#34;</span> <span class="o">&gt;&gt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">to</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
                <span class="o">&gt;&gt;</span> <span class="s">&#34; by &#34;</span> <span class="o">&gt;&gt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="n">execute</span><span class="p">(</span><span class="n">fsm</span><span class="p">.</span><span class="n">ctx</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="guard">Guard</h2>
<p>Guardå‘ç”Ÿåœ¨ç¦»å¼€çŠ¶æ€å‰ï¼Œè¿”å›ä¸€ä¸ªboolå€¼ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™å¯ä»¥è½¬ç§»ï¼Œå¦åˆ™ä¿æŒåœ¨åŸçŠ¶æ€ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">BaseGuard</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">BaseGuard</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SourceState</span><span class="p">,</span> <span class="k">class</span> <span class="nc">TargetState</span><span class="o">&gt;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="n">Event</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">,</span> <span class="n">Fsm</span> <span class="o">&amp;</span><span class="n">fsm</span><span class="p">,</span> <span class="n">SourceState</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">from</span><span class="p">,</span> <span class="n">TargetState</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">to</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">execute</span><span class="p">(</span><span class="n">fsm</span><span class="p">.</span><span class="n">ctx</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;[guard] &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; -&gt; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span> <span class="o">&lt;&lt;</span> <span class="n">ok</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34; from &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">from</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; to &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
                <span class="o">&lt;&lt;</span> <span class="s">&#34; by &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">ok</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nb">true</span><span class="p">;}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="transition_table">transition_table</h2>
<p>çŠ¶æ€è½¬ç§»è¡¨çš„å®Œæ•´å½¢æ€æ˜¯5ä¸ªå…ƒç´ ï¼š<br>
fromStateï¼Œ Eventï¼Œ ToStateï¼Œ Actionï¼Œ Guard<br>
ä¸€èˆ¬ä½¿ç”¨functor_rowé‡Œçš„boost::msm::front::Rowæ¥å®šä¹‰è½¬ç§»è¡¨çš„æ¯ä¸€è¡Œã€‚å…¶ä¸­ç©ºçš„è¦ç´ ä½¿ç”¨boost::msm::front::noneæ¥è¡¨ç¤ºã€‚<br>
å¯ä»¥ä½¿ç”¨usingæ¥ç®€åŒ–è¿™ä¸ªä¸¤ä¸ªç±»å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">Row</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">Row</span><span class="o">&lt;</span><span class="n">T</span><span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">using</span> <span class="n">None</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">none</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå®Œæ•´çš„çŠ¶æ€äº†ã€‚</p>
<p><img src="//www.plantuml.com/plantuml/png/JOoz2a8n38NtFaLz095cT93hS15dHn4fDc2WYL9JdzzOexWad9_lJ0_DJJlNiD0hCiPxpIJ1NCMu5zAuZcIFSZqFqwF3-wP_0IvcASOeDYOnxTIOMcw-tEVz333YkEkvbNIQdoYQLjkBqasy2TRquH63nn0cbDAvlW00" alt=""></p>
<p>ä»£ç ä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// ---State Machine front-end
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Sm</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">state_machine_def</span><span class="o">&lt;</span><span class="n">Sm</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="c1">// ---States
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">State1</span> <span class="o">:</span> <span class="n">BaseState</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">State2</span> <span class="o">:</span> <span class="n">BaseState</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">Init</span> <span class="o">:</span> <span class="n">BaseState</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">End</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">terminate_state</span><span class="o">&lt;&gt;</span> <span class="p">{};</span>

    <span class="c1">// ---Events
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">Event1</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">Event2</span> <span class="p">{};</span>

    <span class="c1">// ---Actions
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">Action1</span> <span class="o">:</span> <span class="n">BaseAction</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">Action2</span> <span class="o">:</span> <span class="n">BaseAction</span> <span class="p">{};</span>

    <span class="c1">// ---Guard
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">Guard1</span> <span class="o">:</span> <span class="n">BaseGuard</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">GTrue</span> <span class="o">:</span> <span class="n">BaseGuard</span> <span class="p">{};</span>
    <span class="k">struct</span> <span class="nc">GFalse</span> <span class="o">:</span> <span class="n">BaseGuard</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">// ---Set initial state
</span><span class="c1"></span>    <span class="k">using</span> <span class="n">initial_state</span> <span class="o">=</span> <span class="n">Init</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">T</span><span class="o">&gt;</span>
    <span class="k">using</span> <span class="n">Row</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">Row</span><span class="o">&lt;</span><span class="n">T</span><span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">None</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">msm</span><span class="o">::</span><span class="n">front</span><span class="o">::</span><span class="n">none</span><span class="p">;</span>

    <span class="c1">// ---Transition Table
</span><span class="c1"></span>    <span class="k">struct</span> <span class="nc">transition_table</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span>
        <span class="c1">//   Start * Event * Next  * Action * Guard
</span><span class="c1"></span>        <span class="n">Row</span><span class="o">&lt;</span> <span class="n">Init</span><span class="p">,</span>   <span class="n">None</span><span class="p">,</span>   <span class="n">State1</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span>    <span class="n">None</span>   <span class="o">&gt;</span><span class="p">,</span>
        <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event1</span><span class="p">,</span> <span class="n">State2</span><span class="p">,</span> <span class="n">Action1</span><span class="p">,</span> <span class="n">Guard1</span> <span class="o">&gt;</span><span class="p">,</span>
        <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State2</span><span class="p">,</span> <span class="n">Event2</span><span class="p">,</span> <span class="n">End</span><span class="p">,</span>    <span class="n">Action2</span><span class="p">,</span> <span class="n">None</span>   <span class="o">&gt;</span>
    <span class="o">&gt;</span> <span class="p">{};</span>

    <span class="n">Context</span> <span class="n">ctx</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// ---Pick a back-end
</span><span class="c1"></span><span class="k">using</span> <span class="n">Fsm</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="nl">msm</span><span class="p">:</span><span class="err">ğŸ”™</span><span class="o">:</span><span class="n">state_machine</span><span class="o">&lt;</span><span class="n">Sm</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Fsm</span> <span class="n">fsm</span><span class="p">;</span>
    <span class="n">fsm</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&gt; Send Event1</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
    <span class="n">fsm</span><span class="p">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">Event1</span><span class="p">{});</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;&gt; Send Event2</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
    <span class="n">fsm</span><span class="p">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">Event2</span><span class="p">{});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">[state]...Entering Init by InitEvent
[state]...Leaving Init by none
[state]...Entering State1 by none
&gt; Send Event1
[guard] Guard1 -&gt; true from State1 to State2 by Event1
[state]...Leaving State1 by Event1
[action] Do Action1 from State1 to State2 by Event1
[state]...Entering State2 by Event1
&gt; Send Event2
[state]...Leaving State2 by Event2
[action] Do Action2 from State2 to End by Event2
</code></pre></td></tr></table>
</div>
</div><h2 id="if-else">if-else</h2>
<p>åœ¨transition_tableä¸­ï¼Œåœ¨ä¸‹æ–¹çš„rowä¼˜å…ˆäºä¸Šæ–¹çš„rowå…ˆæ‰§è¡Œã€‚<br>
è¿™ä¸€èŠ‚é€šè¿‡å®ç°ä¸€ä¸ªif-elseçš„é€»è¾‘æ¥è¯´æ˜åœ¨transition_tableé‡Œrowçš„ä¼˜å…ˆçº§ã€‚</p>
<p><img src="//www.plantuml.com/plantuml/png/TO-n3e8m48RtFiNv09MKqGI20mCpYOjnQF28JOwJo45yV0yvJHnScdv_lylVgoQ93va7SZkvuO0mKapiD1M4TZs3GTE_qQYc2JTkE0buNveD1wWNP0bPYtAA5Fu9kGcvizmJzgAQ5QbtJZrqyjmlaQ0e85ooOoVfpk4xKjf7DX_rxZxZVXxrUIrtvlo65V9Lztu1" alt=""></p>
<p>ä¸¤ä¸ªAction</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// ---Actions
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">SetVal1</span> <span class="o">:</span> <span class="n">BaseAction</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="n">ctx</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">ctx</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">SetVal2</span> <span class="o">:</span> <span class="n">BaseAction</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="n">ctx</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">ctx</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>Guard</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"> <span class="k">struct</span> <span class="nc">IfGuard</span> <span class="o">:</span> <span class="n">BaseGuard</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="n">ctx</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="p">.</span><span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>transition_table</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"> <span class="c1">// ---Transition Table
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">transition_table</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span>
    <span class="c1">//   Start * Event * Next  * Action * Guard
</span><span class="c1"></span>    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">Init</span>   <span class="p">,</span> <span class="n">Event1</span>    <span class="p">,</span> <span class="n">State1</span>    <span class="p">,</span> <span class="n">SetVal1</span>   <span class="p">,</span> <span class="n">None</span>  <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">Init</span>   <span class="p">,</span> <span class="n">Event2</span>    <span class="p">,</span> <span class="n">State1</span>    <span class="p">,</span> <span class="n">SetVal2</span>   <span class="p">,</span> <span class="n">None</span>  <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span> <span class="p">,</span> <span class="n">None</span>      <span class="p">,</span> <span class="n">ElseState</span> <span class="p">,</span> <span class="n">None</span>      <span class="p">,</span> <span class="n">None</span>  <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span> <span class="p">,</span> <span class="n">None</span>      <span class="p">,</span> <span class="n">IfState</span>   <span class="p">,</span> <span class="n">None</span>      <span class="p">,</span> <span class="n">IfGuard</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">IfState</span><span class="p">,</span> <span class="n">None</span>      <span class="p">,</span> <span class="n">Init</span>      <span class="p">,</span> <span class="n">None</span>      <span class="p">,</span> <span class="n">None</span>  <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">ElseState</span><span class="p">,</span> <span class="n">None</span>    <span class="p">,</span> <span class="n">Init</span>      <span class="p">,</span> <span class="n">None</span>      <span class="p">,</span> <span class="n">None</span>  <span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="p">{};</span>
</code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºä¸º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">[state]...Entering Init by InitEvent
&gt; Send Event1
[state]...Leaving Init by Event1
[action] Do SetVal1 from Init to State1 by Event1
[state]...Entering State1 by Event1
[guard] IfGuard -&gt; true from State1 to IfState by none
[state]...Leaving State1 by none
[state]...Entering IfState by none
[state]...Leaving IfState by none
[state]...Entering Init by none
&gt; Send Event2
[state]...Leaving Init by Event2
[action] Do SetVal2 from Init to State1 by Event2
[state]...Entering State1 by Event2
[guard] IfGuard -&gt; false from State1 to IfState by none
[state]...Leaving State1 by none
[state]...Entering ElseState by none
[state]...Leaving ElseState by none
[state]...Entering Init by none
</code></pre></td></tr></table>
</div>
</div><h2 id="çŠ¶æ€è‡ªè½¬ç§»">çŠ¶æ€è‡ªè½¬ç§»</h2>
<p>è½¬ç§»åˆ°è‡ªå·±æœ¬èº«æœ‰ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥ç§°ä¸ºå¤–éƒ¨è‡ªè½¬ç§»å’Œå†…éƒ¨è‡ªè½¬ç§»ã€‚å¦‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// ---Transition Table
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">transition_table</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span>
    <span class="c1">//   Start * Event * Next  * Action * Guard
</span><span class="c1"></span>    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">Init</span><span class="p">,</span>   <span class="n">None</span><span class="p">,</span>   <span class="n">State1</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span>    <span class="n">None</span>   <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event1</span><span class="p">,</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Action1</span><span class="p">,</span> <span class="n">Guard1</span> <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event2</span><span class="p">,</span> <span class="n">None</span>  <span class="p">,</span> <span class="n">Action2</span><span class="p">,</span> <span class="n">GTrue</span>  <span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="p">{};</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>startå’Œnextéƒ½æ˜¯State1ï¼Œæ­¤æ—¶ä¼šæ‰§è¡ŒState1çš„on_exitå’Œon_entryã€‚</li>
<li>nextæ—¶Noneï¼Œä¸ä¼šæ‰§è¡Œon_exitå’Œon_entryã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">[state]...Entering Init by InitEvent
[state]...Leaving Init by none
[state]...Entering State1 by none
&gt; Send Event1
[guard] Guard1 -&gt; true from State1 to State1 by Event1
[state]...Leaving State1 by Event1
[action] Do Action1 from State1 to State1 by Event1
[state]...Entering State1 by Event1
&gt; Send Event2
[guard] GTrue -&gt; true from State1 to State1 by Event2
[action] Do Action2 from State1 to State1 by Event2
</code></pre></td></tr></table>
</div>
</div><h2 id="exception">exception</h2>
<p>çŠ¶æ€æœºçš„on_entry, on_exit, Action, Guardéƒ½å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œä¸è‡ªå·±å¤„ç†çš„è¯ï¼Œç¨‹åºä¼šå¼‚å¸¸é€€å‡ºã€‚å¯ä»¥é€šè¿‡è‡ªå·±å®šä¹‰exception_caughtæ–¹æ³•æ¥è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ã€‚<br>
å¦å¤–æˆ‘ä»¬å¯ä»¥é‡è½½no_transitionçš„æ–¹æ³•æ¥å¤„ç†æ²¡æœ‰å¯¹åº”çŠ¶æ€è½¬ç§»è§„åˆ™çš„æƒ…å†µã€‚<br>
ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">exception_caught</span> <span class="p">(</span><span class="n">Event</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">evt</span><span class="p">,</span> <span class="n">Fsm</span><span class="o">&amp;</span> <span class="n">fsm</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;catch exception &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; while &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Event</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Fsm</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">no_transition</span><span class="p">(</span><span class="n">Event</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">evt</span><span class="p">,</span> <span class="n">Fsm</span> <span class="o">&amp;</span><span class="n">fsm</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;No transition item for &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span>
        <span class="o">&lt;&lt;</span> <span class="s">&#34; while &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">get_typename</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>é’ˆå¯¹äº§ç”Ÿå¼‚å¸¸çš„ä¸åŒæ—¶æœºï¼Œå…¶è¡¨ç°æœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªout_of_rangeçš„å¼‚å¸¸æ¥çœ‹ä¸€ä¸‹å®é™…ç»“æœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">sth_wrong</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="nc">ExceptionOnEntry</span> <span class="o">:</span> <span class="n">BaseState</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">sth_wrong</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">ExceptionOnExit</span> <span class="o">:</span> <span class="n">BaseState</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">clean</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">sth_wrong</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">ExceptionAction</span> <span class="o">:</span> <span class="n">BaseAction</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">sth_wrong</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">ExceptionGuard</span> <span class="o">:</span> <span class="n">BaseGuard</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="nf">execute</span><span class="p">(</span><span class="n">Context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">sth_wrong</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
    <span class="c1">// ---Transition Table
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">transition_table</span> <span class="o">:</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span>
    <span class="c1">//   Start * Event * Next  * Action * Guard
</span><span class="c1"></span>    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">Init</span><span class="p">,</span>   <span class="n">None</span><span class="p">,</span>   <span class="n">State1</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span>    <span class="n">None</span>   <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event1</span><span class="p">,</span> <span class="n">ExceptionOnEntry</span><span class="p">,</span> <span class="n">Action1</span><span class="p">,</span> <span class="n">GTrue</span>  <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event2</span><span class="p">,</span> <span class="n">State2</span><span class="p">,</span> <span class="n">ExceptionAction</span><span class="p">,</span> <span class="n">GTrue</span> <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event3</span><span class="p">,</span> <span class="n">State2</span><span class="p">,</span> <span class="n">Action1</span><span class="p">,</span> <span class="n">ExceptionGuard</span> <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Event4</span><span class="p">,</span> <span class="n">ExceptionOnExit</span><span class="p">,</span> <span class="n">Action1</span><span class="p">,</span> <span class="n">GTrue</span> <span class="o">&gt;</span><span class="p">,</span>
    <span class="n">Row</span><span class="o">&lt;</span> <span class="n">ExceptionOnExit</span><span class="p">,</span> <span class="n">Event5</span><span class="p">,</span> <span class="n">State1</span><span class="p">,</span> <span class="n">Action1</span><span class="p">,</span> <span class="n">GTrue</span> <span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="p">{};</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œç»“æœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">[state]...Entering Init by InitEvent
[state]...Leaving Init by none
[state]...Entering State1 by none
&gt; Send Event1
[guard] GTrue -&gt; true from State1 to ExceptionOnEntry by Event1
[state]...Leaving State1 by Event1
[action] Do Action1 from State1 to ExceptionOnEntry by Event1
[state]...Entering ExceptionOnEntry by Event1
catch exception vector::_M_range_check: __n (which is 2) &gt;= this-&gt;size() (which is 1) while Event1
&gt; Send Event2
[guard] GTrue -&gt; true from State1 to State2 by Event2
[state]...Leaving State1 by Event2
[action] Do ExceptionAction from State1 to State2 by Event2
catch exception vector::_M_range_check: __n (which is 2) &gt;= this-&gt;size() (which is 1) while Event2
&gt; Send Event3
catch exception vector::_M_range_check: __n (which is 2) &gt;= this-&gt;size() (which is 1) while Event3
&gt; Send Event4
[guard] GTrue -&gt; true from State1 to ExceptionOnExit by Event4
[state]...Leaving State1 by Event4
[action] Do Action1 from State1 to ExceptionOnExit by Event4
[state]...Entering ExceptionOnExit by Event4
&gt; Send Event5
[guard] GTrue -&gt; true from ExceptionOnExit to State1 by Event5
[state]...Leaving ExceptionOnExit by Event5
catch exception vector::_M_range_check: __n (which is 2) &gt;= this-&gt;size() (which is 1) while Event5
&gt; Send Event1
No transition item for 2 while Event1
</code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥æ€»ç»“ï¼š<br>
ä¸€æ¬¡çŠ¶æ€è¿ç§»çš„è¿‡ç¨‹åˆ†ä¸ºguard-&gt;on_exit-&gt;action-&gt;on_entryã€‚å…¶ä¸­æŸä¸€æ­¥æŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒçŠ¶æ€éƒ½ä¼šå›åˆ°sourceStateã€‚</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">lclei</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2022-07-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/cpp/">cpp</a>
          <a href="/tags/boost/">boost</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/flock/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">è®°ä¸€æ¬¡æ–‡ä»¶é”æ­»é”é—®é¢˜</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/hugo_and_git_submodule/">
            <span class="next-text nav-default">Hugo and git submodule</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:lclei@mail.ustc.edu.cn" class="iconfont icon-email" title="email"></a>
      <a href="https://gitee.com/lclei" class="iconfont icon-gitee" title="gitee"></a>
      <a href="https://gitee.com/lclei" class="iconfont icon-github" title="github"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>lclei</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>










<script src="https://cdn.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js" integrity="sha256-Qsk2KRBCN5qVZX7B+8+2IvQl1Aqc723qV1tBCQaVoqo=" crossorigin="anonymous"></script>
<script>
  (function(){
    let plantumlPrefix = "language-plantuml";
    Array.prototype.forEach.call(document.querySelectorAll("[class^=" + plantumlPrefix + "]"), function(code){
      let image = document.createElement("IMG");
      image.loading = 'lazy'; 
      image.src = 'http://www.plantuml.com/plantuml/svg/~1' + plantumlEncoder.encode(code.innerText);
      code.parentNode.insertBefore(image, code);
      code.style.display = 'none';
    });
  })();
</script>


</body>
</html>
